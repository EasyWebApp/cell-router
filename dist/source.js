//
//  Generated by https://www.npmjs.com/package/amd-bundle
//
(function (factory) {

    if ((typeof define === 'function')  &&  define.amd)
        define('Source', ["web-cell"], factory);
    else if (typeof module === 'object')
        return  module.exports = factory(require('web-cell'));
    else
        return  this['Source'] = factory(this['web-cell']);

})(function (web_cell) {

function merge(base, path) {

    return (base + '/' + path).replace(/\/\//g, '/').replace(/[^/.]+\/\.\.\//g, '').replace(/\.\//g, function (match, index, input) {

        return input[index - 1] === '.' ? match : '';
    });
}

    var require = _require_.bind(null, './');

    function _require_(base, path) {

        var module = _module_[
                /^\w/.test( path )  ?  path  :  ('./' + merge(base, path))
            ],
            exports;

        if (! module.exports) {

            module.exports = { };

            var dependency = module.dependency;

            for (var i = 0;  dependency[i];  i++)
                module.dependency[i] = require( dependency[i] );

            exports = module.factory.apply(
                null,  module.dependency.concat(
                    _require_.bind(null, module.base),  module.exports,  module
                )
            );

            if (exports != null)  module.exports = exports;

            delete module.dependency;  delete module.factory;
        }

        return module.exports;
    }

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _module_ = {
    './PageStack': {
        base: '.',
        dependency: [],
        factory: function factory(require, exports, module) {
            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            /**
             * Page DOM storage
             */

            var PageStack = function () {
                /**
                 * @param {string} container - CSS selector of Page container
                 */
                function PageStack(container) {
                    _classCallCheck(this, PageStack);

                    this.length = this.last = 0;

                    this.container = document.querySelector(container);
                }

                /**
                 * @protected
                 *
                 * @param {number} index
                 *
                 * @return {PageStack}
                 */


                _createClass(PageStack, [{
                    key: 'turnOver',
                    value: function turnOver(index) {
                        var _index;

                        index = index != null ? index : this.length++;

                        (_index = this[index] = this[index] || document.createDocumentFragment()).append.apply(_index, _toConsumableArray(this.container.childNodes));

                        return this;
                    }

                    /**
                     * @param {string} tag - Tag name of a Page component
                     *
                     * @return {string} HTML source of this page
                     */

                }, {
                    key: 'turnTo',
                    value: function turnTo(tag) {

                        tag = document.createElement(tag);

                        this.turnOver().container.append(tag);

                        this.last = this.length;

                        return this.container.innerHTML;
                    }

                    /**
                     * @param {number} page - Index of a Page component
                     *
                     * @return {boolean} Whether this page has DOM cache
                     */

                }, {
                    key: 'backTo',
                    value: function backTo(page) {

                        this.turnOver(this.last);

                        this.last = page;

                        page = this[page];

                        return page ? this.container.append(page) || true : false;
                    }
                }]);

                return PageStack;
            }();

            exports.default = PageStack;
        }
    },
    './CellRoute': {
        base: '.',
        dependency: [],
        factory: function factory(require, exports, module) {
            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _webCell = require('web-cell');

            var route_map = new Map();

            /**
             * Route entry
             */

            var CellRoute = function (_HTMLElement) {
                _inherits(CellRoute, _HTMLElement);

                function CellRoute() {
                    _classCallCheck(this, CellRoute);

                    return _possibleConstructorReturn(this, (CellRoute.__proto__ || Object.getPrototypeOf(CellRoute)).call(this));
                }

                /**
                 * @protected
                 *
                 * @type {Map}
                 */


                _createClass(CellRoute, [{
                    key: 'connectedCallback',
                    value: function connectedCallback() {

                        route_map.set(this, [this.getAttribute('path'), this.getAttribute('tag')]);
                    }
                }, {
                    key: 'disconnectedCallback',
                    value: function disconnectedCallback() {
                        route_map.delete(this);
                    }

                    /**
                     * @type {string}
                     */

                }, {
                    key: 'path',
                    get: function get() {
                        return route_map.get(this)[0];
                    }

                    /**
                     * Tag name of a Page component
                     *
                     * @type {string}
                     */

                }, {
                    key: 'tag',
                    get: function get() {
                        return route_map.get(this)[1];
                    }
                }], [{
                    key: 'map',
                    get: function get() {
                        return route_map;
                    }
                }]);

                return CellRoute;
            }(HTMLElement);

            exports.default = CellRoute;
            (0, _webCell.component)(CellRoute);
        }
    },
    './index': {
        base: '.',
        dependency: [],
        factory: function factory(require, exports, module) {
            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _webCell = require('web-cell');

            var _CellRoute = require('./CellRoute');

            var _CellRoute2 = _interopRequireDefault(_CellRoute);

            var _PageStack = require('./PageStack');

            var _PageStack2 = _interopRequireDefault(_PageStack);

            function _interopRequireDefault(obj) {
                return obj && obj.__esModule ? obj : { default: obj };
            }

            var on = _CellRoute2.default.prototype.on;

            var mode = 'hash',
                page,
                prefix = '';

            /**
             * Routes elements wrapper
             */

            var CellRouter = function (_HTMLElement2) {
                _inherits(CellRouter, _HTMLElement2);

                function CellRouter() {
                    _classCallCheck(this, CellRouter);

                    return _possibleConstructorReturn(this, (CellRouter.__proto__ || Object.getPrototypeOf(CellRouter)).call(this));
                }

                _createClass(CellRouter, [{
                    key: 'connectedCallback',
                    value: function connectedCallback() {

                        document.addEventListener('DOMContentLoaded', function () {

                            page = new _PageStack2.default('main');

                            window.history.replaceState({
                                title: document.title,
                                index: page.last,
                                HTML: page.container.innerHTML
                            }, document.title, '');
                        });

                        mode = this.listen().getAttribute('mode') || mode;

                        if (mode === 'hash') prefix = '#';
                    }

                    /**
                     * `path` or `hash`
                     *
                     * @type {string}
                     */

                }, {
                    key: 'navTo',


                    /**
                     * @protected
                     *
                     * @param {Element} link - A `<a href="" />`
                     */
                    value: function navTo(link) {

                        var path = link.getAttribute('href'),
                            title = link.title || link.textContent.trim();

                        var tag = this.map[path];

                        if (!tag) return;

                        var HTML = page.turnTo(tag);

                        window.history.pushState({ path: path, tag: tag, title: title, index: page.last, HTML: HTML }, title, prefix + path);

                        document.title = title;
                    }

                    /**
                     * @return {CellRouter} This element
                     */

                }, {
                    key: 'listen',
                    value: function listen() {

                        var router = this;

                        on.call(document.body, 'click', 'a[href]', function (event) {

                            if ((this.target || '_self') !== '_self') return;

                            event.preventDefault();

                            router.navTo(this);
                        });

                        window.addEventListener('popstate', function (event) {

                            var state = event.state;

                            if (!state) return;

                            if (!page.backTo(state.index)) page.container.append(_webCell.View.parseDOM(state.HTML));

                            document.title = state.title;
                        });

                        return this;
                    }
                }, {
                    key: 'mode',
                    get: function get() {
                        return mode;
                    }

                    /**
                     * Key for path, Value for tag
                     *
                     * @type {object}
                     */

                }, {
                    key: 'map',
                    get: function get() {

                        var map = _CellRoute2.default.map,
                            route = {};

                        var _iteratorNormalCompletion = true;
                        var _didIteratorError = false;
                        var _iteratorError = undefined;

                        try {
                            for (var _iterator = this.children[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                                var child = _step.value;


                                var item = map.get(child);

                                if (item) route[item[0]] = item[1];
                            }
                        } catch (err) {
                            _didIteratorError = true;
                            _iteratorError = err;
                        } finally {
                            try {
                                if (!_iteratorNormalCompletion && _iterator.return) {
                                    _iterator.return();
                                }
                            } finally {
                                if (_didIteratorError) {
                                    throw _iteratorError;
                                }
                            }
                        }

                        return route;
                    }
                }]);

                return CellRouter;
            }(HTMLElement);

            exports.default = CellRouter;
            (0, _webCell.component)(CellRouter);
        }
    },
    'web-cell': { exports: web_cell }
};

    return require('./index');
});